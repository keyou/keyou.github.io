<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1542px" height="1022px" viewBox="-0.5 -0.5 1542 1022" style="background-color: rgb(255, 255, 255);"><defs/><g><path d="M 331 410 L 291 410 L 291 400 L 259.12 400" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 252.12 400 L 259.12 396.5 L 259.12 403.5 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 578.99 390 L 591 390 L 591 170 L 644.63 170" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 571.99 390 L 575.49 387.94 L 578.99 390 L 575.49 392.06 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 649.88 170 L 642.88 173.5 L 644.63 170 L 642.88 166.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="331" y="370" width="240" height="80" rx="12" ry="12" fill="#dae8fc" stroke="#6c8ebf" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 410px; margin-left: 332px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div><span style="background-color: initial;">blink::</span><b style="background-color: initial;">C</b><span style="background-color: initial;">anvas</span><b style="background-color: initial;">R</b><span style="background-color: initial;">endering</span><b style="background-color: initial;">C</b><span style="background-color: initial;">ontext</span><br /></div><div>cc::CcLayer():cc::Layer</div><div>FinalizeFrame() 结束一帧的绘制</div><div>对应js中的canvas context，不同的context实现了不同的canvas绘制API</div></div></div></div></foreignObject><text x="451" y="414" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::CanvasRenderingContext...</text></switch></g><path d="M 643.01 290 L 611 290 L 611 410 L 577.37 410" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 650.01 290 L 646.51 292.06 L 643.01 290 L 646.51 287.94 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 572.12 410 L 579.12 406.5 L 577.37 410 L 579.12 413.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 611.7142857142862 349.2857142857149)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 349px; margin-left: 612px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">Factory</div></div></div></foreignObject><text x="612" y="353" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Factory</text></switch></g><path d="M 643.01 270 L 591 270 L 577.37 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 650.01 270 L 646.51 272.06 L 643.01 270 L 646.51 267.94 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 572.12 270 L 579.12 266.5 L 577.37 270 L 579.12 273.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 898.99 170 L 931 170 L 931 250 L 964.63 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 891.99 170 L 895.49 167.94 L 898.99 170 L 895.49 172.06 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 969.88 250 L 962.88 253.5 L 964.63 250 L 962.88 246.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 771 250 L 771 218.12" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 771 211.12 L 774.5 218.12 L 767.5 218.12 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="651" y="250" width="240" height="80" rx="12" ry="12" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 290px; margin-left: 652px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::HTMLCanvasElement</div><b>ContentsCcLayer</b><b style="background-color: initial;">() <font color="#ea6b66">非低延迟模式下canvas内容的出口</font></b><b><br /></b><div>GetCanvasRenderingContext()</div><div><span style="background-color: initial; font-size: 11px;">对应html中的canvas标签，当开启低延迟模式时会使用<font style="font-size: 11px;">CanvasResourceDispatcher</font>提交CF</span></div></div></div></div></foreignObject><text x="771" y="294" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::HTMLCanvasElementContentsCcLayer(...</text></switch></g><path d="M 323.01 290 L 257.37 290" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 330.01 290 L 326.51 292.06 L 323.01 290 L 326.51 287.94 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 252.12 290 L 259.12 286.5 L 257.37 290 L 259.12 293.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="331" y="250" width="240" height="80" rx="12" ry="12" fill="#dae8fc" stroke="#6c8ebf" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 290px; margin-left: 332px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">blink::<b>C</b>anvas<b>R</b>esource<b>D</b>ispatcher<br />DispatchFrame(blink::CanvasResource)<br /><b><font color="#ea6b66">低延迟模式下canvas内容的出口</font>，将CanvasResource封装到CF，并提交给viz</b></div></div></div></foreignObject><text x="451" y="294" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::CanvasResourceDispatcher...</text></switch></g><rect x="331" y="210" width="240" height="40" rx="6" ry="6" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 230px; margin-left: 332px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">interface CompositorFrameSinkClient<br />OnBeginFrame()<br />viz 的client接口，接收viz的调度，详见viz</div></div></div></foreignObject><text x="451" y="234" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">interface CompositorFrameSinkClient...</text></switch></g><rect x="11" y="370" width="240" height="120" rx="18" ry="18" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 430px; margin-left: 12px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">base::Thread::TaskObserver<br />WillProcessTask() 在执行task之前调用<br />DidProcessTask() 在执行task之后调用<br />每一个task结束时都会回调，这里用于异步通知CRC绘制完成，<b>在开启低延迟模式时会调用FinalizeFrame，并触发CanvasResourceDispatcher提交CF</b></div></div></div></foreignObject><text x="131" y="434" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">base::Thread::TaskObserver...</text></switch></g><path d="M 451 490 L 451 458.12" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 451 451.12 L 454.5 458.12 L 447.5 458.12 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 571 510 L 611 510 L 611 420 L 642.88 420" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 649.88 420 L 642.88 423.5 L 642.88 416.5 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 898.99 310 L 911 310 L 911 515 L 897.37 515" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 891.99 310 L 895.49 307.94 L 898.99 310 L 895.49 312.06 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 892.12 515 L 899.12 511.5 L 897.37 515 L 899.12 518.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 571 530 L 611 530 L 611 540 L 644.63 540" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 649.88 540 L 642.88 543.5 L 644.63 540 L 642.88 536.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 536px; margin-left: 611px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">通过host</div></div></div></foreignObject><text x="611" y="539" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">通过host</text></switch></g><rect x="331" y="490" width="240" height="80" rx="12" ry="12" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 530px; margin-left: 332px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::CanvasRenderingContext2D</div><div>fillText/strokeText/setWordSpacing()</div><div>对应js中获取到的普通2D context，用于普通canvas的2D绘制，在FinializeFrame的时候触发CRP的flush</div></div></div></div></foreignObject><text x="451" y="534" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::CanvasRenderingContext2D...</text></switch></g><rect x="971" y="10" width="240" height="80" rx="12" ry="12" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 50px; margin-left: 972px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::CanvasRenderingContextFactory<br /></div><div>Create()</div><div>工厂类，用于创建canvas context ，每种context 都对应一个该工厂类</div></div></div></div></foreignObject><text x="1091" y="54" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::CanvasRenderingContextFactory...</text></switch></g><rect x="651" y="370" width="240" height="100" rx="15" ry="15" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 420px; margin-left: 652px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::CanvasPath<br /></div><div>blink::BaseRenderingContext2D</div><div><span style="background-color: initial;">lineTo/rect/</span><span style="background-color: initial;">scale/transform()</span></div><div>Get*PaintCanvas()</div><div><span style="background-color: initial;">FlushCanvas()</span><br /></div><div>定义并实现基本的2D绘制API，绘制操作会通过C.R.Provider记录到cc::PaintCanvas中</div></div></div></div></foreignObject><text x="771" y="424" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::CanvasPath...</text></switch></g><rect x="971" y="90" width="240" height="80" rx="12" ry="12" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 130px; margin-left: 972px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::CanvasRenderingContext2D::Factory</div><div style=""><font style="font-size: 10px;">blink::OffscreenCanvasRenderContext2D::Factory</font></div><div style="font-size: 11px;">blink::WebGL*RenderingContext*::Factory</div><div style="font-size: 11px;"><font style="font-size: 11px;">blink::ImageBitmapRenderingContext*::Factory</font></div><div style="font-size: 11px;">各种派生context的factory</div></div></div></div></foreignObject><text x="1091" y="134" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::CanvasRenderingContext2D::Factory...</text></switch></g><rect x="651" y="810" width="240" height="80" rx="12" ry="12" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 850px; margin-left: 652px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>cc::TextureLayerClient</div><div>PrepareTransferableResource()<br /></div><div>提供CF用的TransferableResource</div></div></div></div></foreignObject><text x="771" y="854" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">cc::TextureLayerClient...</text></switch></g><path d="M 771 590 L 771 801.88" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 771 808.88 L 767.5 801.88 L 774.5 801.88 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 891 540 L 931 540 L 931 330 L 964.63 330" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 969.88 330 L 962.88 333.5 L 964.63 330 L 962.88 326.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="651" y="490" width="240" height="100" rx="15" ry="15" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 540px; margin-left: 652px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink:: Canvas2DLayerBridge</div><div>GetPaintCanvas(): cc::PaintCanvas<br /></div><div>(GetOrCreate)ResourceProvider()<br /></div><div>FinalizeFrame()<br /></div><div>FlushRecording() <font color="#ea6b66">Raster 入口</font></div><div>在2D渲染下对接CRC和CRP,是 raster 的入口以及出口</div></div></div></div></foreignObject><text x="771" y="544" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink:: Canvas2DLayerBridge...</text></switch></g><path d="M 1218.99 290 L 1251 290 L 1251 330 L 1284.63 330" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1211.99 290 L 1215.49 287.94 L 1218.99 290 L 1215.49 292.06 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 1289.88 330 L 1282.88 333.5 L 1284.63 330 L 1282.88 326.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 310px; margin-left: 1251px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 10px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">间接</div></div></div></foreignObject><text x="1251" y="313" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="10px" text-anchor="middle">间接</text></switch></g><rect x="971" y="210" width="240" height="160" rx="24" ry="24" fill="#dae8fc" stroke="#6c8ebf" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 290px; margin-left: 972px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::<b>C</b>anvas<b>R</b>esource<b>P</b>rovider</div><div>static Create*Provider()<br /></div><div><div>Canvas(): cc::PaintCanvas<br /></div></div><div><font style="font-size: 10px;">ProduceCanvasResource():blink::CanvasResource</font><br /></div><div style=""><font style="font-size: 12px;">FlushCanvas*():cc::PaintRecord</font></div><div style=""><font style="font-size: 12px;">SupportsSingleBuffer() 是否支持单buffer</font></div><div style=""><font style="font-size: 12px;">RasterRecord() raster 内容</font></div><div style=""><font style="font-size: 12px;"><b>使用cc::PaintCanvas记录绘制内容，并且在flush的时候把这些内容转成对应的CanvasResource</b></font></div></div></div></div></foreignObject><text x="1091" y="294" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::CanvasResourceProvider...</text></switch></g><rect x="1291" y="290" width="240" height="80" rx="12" ry="12" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 330px; margin-left: 1292px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>cc::PaintCanvas</div><div>drawLine/Path/TextBlob/Image()</div><div>save/restore/flush()</div><div>drawImageRect(cc::PaintImage)</div><div>cc中的2D绘制表面，定义了一系列2D绘制API</div></div></div></div></foreignObject><text x="1411" y="334" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">cc::PaintCanvas...</text></switch></g><rect x="1291" y="370" width="240" height="40" rx="6" ry="6" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 390px; margin-left: 1292px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>cc::SkiaPaintCanvas 对接skia绘制</div><div>cc::RecordPaintCanvas 录制绘制命令到cc::DisplayItemList</div></div></div></div></foreignObject><text x="1411" y="394" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">cc::SkiaPaintCanvas 对接skia绘制...</text></switch></g><path d="M 1091 450 L 1091 483.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1091 488.88 L 1087.5 481.88 L 1091 483.63 L 1094.5 481.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="971" y="370" width="240" height="80" rx="12" ry="12" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 410px; margin-left: 972px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">blink::CanvasResourceProviderBitmap<br />blink::CanvasResourceProviderSharedImage<br />blink::CanvasResourceProviderPassThrough<br />blink::CanvasResourceProviderSwapChain<br />维护相应的CanvasResource</div></div></div></foreignObject><text x="1091" y="414" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::CanvasResourceProviderBitmap...</text></switch></g><rect x="971" y="490" width="240" height="100" rx="15" ry="15" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 540px; margin-left: 972px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">blink::<b>C</b>anvas<b>R</b>esource<br />TakeSkImage(SkImage) 使用SkImage填充<br />GetOrCreateGpuMailbox():gpu::MailBox<br />PrepareTransferableResource(viz::T.R.)<br />Bitmap()::blink::StaticBitmapImage<br />blink中通用的像素资源，有各种存储后端，维护 Raster 结果(的引用)</div></div></div></foreignObject><text x="1091" y="544" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::CanvasResource...</text></switch></g><path d="M 1091 670 L 1091 690 L 1091 670 L 1091 683.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1091 688.88 L 1087.5 681.88 L 1091 683.63 L 1094.5 681.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="971" y="590" width="240" height="80" rx="12" ry="12" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 630px; margin-left: 972px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">blink::CanvasResourceBitmap<br />blink::CanvasResourceSharedImage<br />blink::ExternalCanvasResource<br />blink::CanvasResourceSwapChain<br />使用不同方式存储的CanvasResource</div></div></div></foreignObject><text x="1091" y="634" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::CanvasResourceBitmap...</text></switch></g><path d="M 1211 730 L 1284.63 730" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1289.88 730 L 1282.88 733.5 L 1284.63 730 L 1282.88 726.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="971" y="690" width="240" height="80" rx="12" ry="12" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 730px; margin-left: 972px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">blink::Image<br /><font style="font-size: 10px;"><span style="font-size: 11px;">static LoadPlatformResource(id):blink::Image</span><br /><span style="font-size: 11px;">PaintImageForCurrentFrame():cc::PaintImage<br /></span>Draw(cc::PaintCanvas) 绘制图片到<font style="font-size: 10px;">cc::PaintCanvas</font><br /><span style="font-size: 11px;">blink中通用的图片，可以是常规图片/动图，SVG，生成的图片等</span><br /></font></div></div></div></foreignObject><text x="1091" y="734" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::Image...</text></switch></g><rect x="971" y="770" width="240" height="80" rx="12" ry="12" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 810px; margin-left: 972px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">blink::SVGImage(ForContainer)<br />blink::(Static)BitmapImage<br />blink::GeneratedImage<br />blink::PlaceholderImage<br />blink中不同形式的图片</div></div></div></foreignObject><text x="1091" y="814" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::SVGImage(ForContainer)...</text></switch></g><rect x="1291" y="690" width="240" height="80" rx="12" ry="12" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 730px; margin-left: 1292px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="">cc::PaintImage<br style="font-size: 11px;" />static CreateFromBitmap(SkBitmap)<br style="font-size: 11px;" />Decode() 解码图片<br style="font-size: 11px;" />readPixels() 读像素数据<br style="font-size: 11px;" />GetMailbox()/GetSwSkImage()<br style="font-size: 11px;" /><font style="font-size: 9px;">cc中的通用图片，具体的图片逻辑都转发给各种后端</font><br style="font-size: 11px;" /></font></div></div></div></foreignObject><text x="1411" y="733" fill="#333333" font-family="Helvetica" font-size="11px" text-anchor="middle">cc::PaintImage...</text></switch></g><rect x="11" y="250" width="240" height="80" rx="12" ry="12" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 290px; margin-left: 12px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">interface CompositorFrameSink<br />SubmitCompositorFrame(CF)<br />viz 的CFS接口，负责提交CF，详见viz</div></div></div></foreignObject><text x="131" y="294" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">interface CompositorFrameSink...</text></switch></g><rect x="651" y="50" width="240" height="160" rx="24" ry="24" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 130px; margin-left: 652px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div style="font-size: 11px;">blink::CanvasRenderingHost<br style="font-size: 11px;" /></div><div style="font-size: 11px;">blink::CanvasRenderingContextHost</div><div style="font-size: 11px;">RenderingContext()<br style="font-size: 11px;" /></div><div style="font-size: 11px;"><div style="font-size: 11px;">GetOrCreateCanvasResourceProvider()</div></div><div style="font-size: 11px;">Get(OrCreate)Canvas2DLayerBridge()<br style="font-size: 11px;" /></div><div style="">GetOrCreateResourceDispatcher()<br /></div><div style="">Pre/PostFinalizeFrame()<br /></div><div style="font-size: 11px;">PushFrame(blink::CanvasResource)</div><div style="font-size: 11px;">Commit(blink::CanvasResource)</div><div style="font-size: 11px;"><font color="#ea6b66">创建context</font>，并根据context的类型创建创建性能最优的CanvsResourceProvider</div></div></div></div></foreignObject><text x="771" y="133" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">blink::CanvasRenderingHost...</text></switch></g><rect x="331" y="570" width="240" height="80" rx="12" ry="12" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 610px; margin-left: 332px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::OffscreenCanvasRenderingContext2D</div><div>fillText/strokeText/setWordSpacing()</div><div>commit() 用于主动提交CF</div><div>只用于OffscreenCanvas的2D绘制</div></div></div></div></foreignObject><text x="451" y="614" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::OffscreenCanvasRenderingContext2D...</text></switch></g><path d="M 571 130 L 642.88 130" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 649.88 130 L 642.88 133.5 L 642.88 126.5 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 451 177.99 L 451 203.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 451 170.99 L 453.06 174.49 L 451 177.99 L 448.94 174.49 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 451 208.88 L 447.5 201.88 L 451 203.63 L 454.5 201.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="331" y="90" width="240" height="80" rx="12" ry="12" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 130px; margin-left: 332px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::OffscreenCanvas</div><div>对应js中的offscreencanvas对象，用于实现canvas离屏渲染，js可以使用commit来主动触发CF的提交，viz也可以触发它提交CF</div></div></div></div></foreignObject><text x="451" y="134" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::OffscreenCanvas...</text></switch></g><path d="M 251 680 L 291 680 L 291 430 L 322.88 430" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 329.88 430 L 322.88 433.5 L 322.88 426.5 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 258.99 740 L 311 740 L 311 840 L 324.63 840" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 251.99 740 L 255.49 737.94 L 258.99 740 L 255.49 742.06 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 329.88 840 L 322.88 843.5 L 324.63 840 L 322.88 836.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 331 730 L 291 730 L 291 710 L 259.12 710" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 252.12 710 L 259.12 706.5 L 259.12 713.5 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="331" y="690" width="240" height="80" rx="12" ry="12" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 730px; margin-left: 332px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::WebGLRenderingContext</div><div style="font-size: 11px;"><font style="font-size: 11px;">static CreateWebGraphicsContext3DProvider()</font></div><div style="font-size: 11px;">InitializeNewContext()<br /></div><div>activeTexture/attachShader() GL API 定义<br /></div><div>对应js中的webgl context</div></div></div></div></foreignObject><text x="451" y="734" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::WebGLRenderingContext...</text></switch></g><rect x="11" y="650" width="240" height="120" rx="18" ry="18" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 710px; margin-left: 12px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div><div>blink::WebGLRenderingContextBase</div><div style="font-size: 11px;">static CreateWebGraphicsContext3DProvider()</div><div style="font-size: 11px;">InitializeNewContext()<br /></div><div>activeTexture/attachShader() GL API 定义<br /></div><div>定义并实现基本的webgl API，如果开启了低延迟模式，则在FinalizeFrame的时候从DrawingBuffer导出CS并保存到CRP</div></div></div></div></div></foreignObject><text x="131" y="714" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::WebGLRenderingContextBase...</text></switch></g><rect x="11" y="810" width="240" height="80" rx="12" ry="12" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 850px; margin-left: 12px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::WebGraphicContext3DProvider</div><div>ContextGL():gpu::gles2::GLES2Interface<br /></div><div>RasterInterface():gpu::raster::RasterInterface<br /></div><div>GetGrContext():GrDirectContext<br /></div><div>定义blink使用的3D接口，对接到各种3D环境</div></div></div></div></foreignObject><text x="131" y="854" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::WebGraphicContext3DProvider...</text></switch></g><path d="M 131 930 L 131 898.12" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 131 891.12 L 134.5 898.12 L 127.5 898.12 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="11" y="930" width="240" height="80" rx="12" ry="12" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 970px; margin-left: 12px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>content::WebGraphicsContext3DProviderImpl</div><div>实现blink的3D接口，在content模块中</div></div></div></div></foreignObject><text x="131" y="974" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">content::WebGraphicsContext3DProviderImp...</text></switch></g><path d="M 571 870 L 611 870 L 611 850 L 642.88 850" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 649.88 850 L 642.88 853.5 L 642.88 846.5 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 323.01 870 L 291 870 L 291 850 L 257.37 850" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 330.01 870 L 326.51 872.06 L 323.01 870 L 326.51 867.94 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 252.12 850 L 259.12 846.5 L 257.37 850 L 259.12 853.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="331" y="810" width="240" height="120" rx="18" ry="18" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 870px; margin-left: 332px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>blink::DrawingBuffer</div><div style="font-size: 11px;"><font style="font-size: 11px;">static Create()</font></div><div style="font-size: 11px;"><font style="font-size: 11px;">Bind(GL_FRAMEBUFFER)</font></div><div style="font-size: 11px;"><font style="font-size: 11px;">ContextProvider()<br /></font></div><div style="font-size: 11px;"><font style="font-size: 11px;">ContextGL()<br /></font></div><div style="font-size: 11px;"><font style="font-size: 11px;">ExportCanvasResource()</font></div><div>负责维护GL渲染表面(fbo以及相关的buffer),如果开启了低延迟模式则导出CanvasResource到CRP中</div></div></div></div></foreignObject><text x="451" y="874" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">blink::DrawingBuffer...</text></switch></g><rect x="11" y="510" width="240" height="40" rx="6" ry="6" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 530px; margin-left: 12px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font color="#ea6b66">js 绘制入口</font></div></div></div></foreignObject><text x="131" y="534" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">js 绘制入口</text></switch></g><path d="M 251.5 535 L 251.5 525 L 311.5 525 L 311.5 514.5 L 330.5 530 L 311.5 545.5 L 311.5 535 Z" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>